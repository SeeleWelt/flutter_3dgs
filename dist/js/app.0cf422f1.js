(function(){"use strict";var e={5913:function(e,t,s){var a=s(5130),i=s(9346),o=(s(4188),s(6768));function l(e,t,s,a,i,l){const r=(0,o.g2)("HelloWorld");return(0,o.uX)(),(0,o.Wv)(r)}var r=s(4232);const n={class:"app-container"},c={class:"main-content"},d={class:"content-container"},u={class:"tab-bar"},h={class:"tab-icon-wrapper"},m={class:"tab-icon-wrapper"},p={class:"tab-icon-wrapper"},g={class:"tab-icon-wrapper"};function k(e,t,s,i,l,k){const f=(0,o.g2)("UploadTask"),v=(0,o.g2)("RenderTask"),b=(0,o.g2)("TaskProcessing"),w=(0,o.g2)("PersonStatus"),C=(0,o.g2)("Upload"),F=(0,o.g2)("el-icon"),T=(0,o.g2)("Picture"),L=(0,o.g2)("Management"),y=(0,o.g2)("User");return(0,o.uX)(),(0,o.CE)("div",n,[t[8]||(t[8]=(0,o.Lk)("div",{class:"app-header"},[(0,o.Lk)("h1",{class:"header-title"},"3D模型处理")],-1)),(0,o.Lk)("div",c,[(0,o.Lk)("div",d,[(0,o.bo)((0,o.bF)(f,{onTaskProcessingGetTasks:k.test},null,8,["onTaskProcessingGetTasks"]),[[a.aG,"UploadTask"===l.activeTab]]),"RenderTask"===l.activeTab?((0,o.uX)(),(0,o.Wv)(v,{key:0,"is-view":l.isView,"view-data":l.viewData,"view-file-name":l.viewFileName},null,8,["is-view","view-data","view-file-name"])):(0,o.Q3)("",!0),(0,o.bo)((0,o.bF)(b,{ref:"RenderTaskRef",onViewResult:k.viewResult},null,8,["onViewResult"]),[[a.aG,"TaskProcessing"===l.activeTab]]),(0,o.bo)((0,o.bF)(w,null,null,512),[[a.aG,"PersonStatus"===l.activeTab]])])]),(0,o.Lk)("div",u,[(0,o.Lk)("div",{class:(0,r.C4)(["tab-item",{active:"UploadTask"===l.activeTab}]),onClick:t[0]||(t[0]=e=>k.handleTabClick("UploadTask"))},[(0,o.Lk)("div",h,[(0,o.bF)(F,{class:"tab-icon"},{default:(0,o.k6)(()=>[(0,o.bF)(C)]),_:1})]),t[4]||(t[4]=(0,o.Lk)("span",{class:"tab-text"},"模型处理",-1))],2),(0,o.Lk)("div",{class:(0,r.C4)(["tab-item",{active:"RenderTask"===l.activeTab}]),onClick:t[1]||(t[1]=e=>k.handleTabClick("RenderTask"))},[(0,o.Lk)("div",m,[(0,o.bF)(F,{class:"tab-icon"},{default:(0,o.k6)(()=>[(0,o.bF)(T)]),_:1})]),t[5]||(t[5]=(0,o.Lk)("span",{class:"tab-text"},"模型渲染",-1))],2),(0,o.Lk)("div",{class:(0,r.C4)(["tab-item",{active:"TaskProcessing"===l.activeTab}]),onClick:t[2]||(t[2]=e=>k.handleTabClick("TaskProcessing"))},[(0,o.Lk)("div",p,[(0,o.bF)(F,{class:"tab-icon"},{default:(0,o.k6)(()=>[(0,o.bF)(L)]),_:1})]),t[6]||(t[6]=(0,o.Lk)("span",{class:"tab-text"},"任务管理",-1))],2),(0,o.Lk)("div",{class:(0,r.C4)(["tab-item",{active:"PersonStatus"===l.activeTab}]),onClick:t[3]||(t[3]=e=>k.handleTabClick("PersonStatus"))},[(0,o.Lk)("div",g,[(0,o.bF)(F,{class:"tab-icon"},{default:(0,o.k6)(()=>[(0,o.bF)(y)]),_:1})]),t[7]||(t[7]=(0,o.Lk)("span",{class:"tab-text"},"个人中心",-1))],2)])])}const f={class:"render-task-container"},v={class:"navbar"},b={class:"core-content"},w={key:0,class:"empty-state"},C={class:"control-btn-item pos-1"},F={class:"control-btn-item pos-2"},T={class:"control-btn-item pos-3"},L={class:"control-btn-item pos-4"},y={class:"control-btn-item pos-5"},S={class:"control-btn-item pos-6"},P={class:"control-btn-item pos-7"},x={class:"control-btn-item pos-8"},D={class:"control-btn-item pos-9"},E={class:"control-btn-item pos-10"},_={class:"control-btn-item pos-11"};function V(e,t,s,i,l,n){const c=(0,o.g2)("Upload"),d=(0,o.g2)("el-icon"),u=(0,o.g2)("el-button"),h=(0,o.g2)("Search"),m=(0,o.g2)("el-tooltip"),p=(0,o.g2)("WindPower"),g=(0,o.g2)("Place"),k=(0,o.g2)("Camera"),V=(0,o.g2)("MostlyCloudy");return(0,o.uX)(),(0,o.CE)("div",f,[(0,o.Lk)("div",v,[t[18]||(t[18]=(0,o.Lk)("h1",{class:"nav-title"},"模型渲染视图",-1)),(0,o.bF)(u,{class:"nav-btn help-btn",size:"default",onClick:n.loadModelFromFlutter,circle:""},{default:(0,o.k6)(()=>[(0,o.bF)(d,null,{default:(0,o.k6)(()=>[(0,o.bF)(c)]),_:1})]),_:1},8,["onClick"])]),(0,o.Lk)("div",b,[(0,o.Lk)("div",{ref:"viewerContainer",class:(0,r.C4)(["viewer-container",{fullscreen:l.isManualFullscreen}]),onDblclick:t[0]||(t[0]=e=>l.isManualFullscreen=!l.isManualFullscreen),onTouchstart:t[1]||(t[1]=(...e)=>n.handleTouchStart&&n.handleTouchStart(...e)),onClick:t[2]||(t[2]=(...e)=>n.closeControlPanel&&n.closeControlPanel(...e))},[l.splatScene||l.isViewerLoading?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",w,[...t[19]||(t[19]=[(0,o.Lk)("div",{class:"empty-icon"},[(0,o.Lk)("i",{class:"el-icon-cube"})],-1),(0,o.Lk)("p",{class:"empty-text"},"尚未加载模型",-1),(0,o.Lk)("p",{class:"empty-subtext"},"点击下方按钮导入3D模型文件",-1)])]))],34)]),(0,o.Lk)("div",{class:"draggable-float-container",style:(0,r.Tr)({left:l.floatLeft+"px",top:l.floatTop+"px"}),onMousedown:t[12]||(t[12]=(...e)=>n.startDrag&&n.startDrag(...e)),onTouchstart:t[13]||(t[13]=(...e)=>n.startDrag&&n.startDrag(...e)),onMouseup:t[14]||(t[14]=(...e)=>n.stopDrag&&n.stopDrag(...e)),onTouchend:t[15]||(t[15]=(...e)=>n.stopDrag&&n.stopDrag(...e)),onMousemove:t[16]||(t[16]=(...e)=>n.handleDrag&&n.handleDrag(...e)),onTouchmove:t[17]||(t[17]=(...e)=>n.handleDrag&&n.handleDrag(...e))},[(0,o.Lk)("div",{class:(0,r.C4)(["control-float-btn",{active:l.isControlPanelOpen}]),onClick:t[3]||(t[3]=(0,a.D$)((...e)=>n.toggleControlPanel&&n.toggleControlPanel(...e),["stop"]))},[...t[20]||(t[20]=[(0,o.Lk)("i",{class:"el-icon-dashboard"},null,-1)])],2),(0,o.Lk)("div",{class:(0,r.C4)(["control-circle-container",{show:l.isControlPanelOpen}])},[(0,o.Lk)("div",C,[(0,o.bF)(m,{effect:"dark",content:"显示/隐藏信息",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{type:l.viewerControls.showInfo?"primary":"default",onClick:(0,a.D$)(n.toggleInfoPanel,["stop"]),size:"default",circle:""},{default:(0,o.k6)(()=>[(0,o.bF)(d,null,{default:(0,o.k6)(()=>[(0,o.bF)(h)]),_:1})]),_:1},8,["type","onClick"])]),_:1})]),(0,o.Lk)("div",F,[(0,o.bF)(m,{effect:"dark",content:"显示/隐藏光标",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{type:l.viewerControls.showMeshCursor?"primary":"default",onClick:(0,a.D$)(n.toggleMeshCursor,["stop"]),size:"default",circle:""},{default:(0,o.k6)(()=>[(0,o.bF)(d,null,{default:(0,o.k6)(()=>[(0,o.bF)(p)]),_:1})]),_:1},8,["type","onClick"])]),_:1})]),(0,o.Lk)("div",T,[(0,o.bF)(m,{effect:"dark",content:"显示/隐藏平面",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{type:l.viewerControls.showControlPlane?"primary":"default",onClick:(0,a.D$)(n.toggleControlPlane,["stop"]),size:"default",circle:""},{default:(0,o.k6)(()=>[(0,o.bF)(d,null,{default:(0,o.k6)(()=>[(0,o.bF)(g)]),_:1})]),_:1},8,["type","onClick"])]),_:1})]),(0,o.Lk)("div",L,[(0,o.bF)(m,{effect:"dark",content:"切换透视/正交",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{type:l.viewerControls.isOrthographicCamera?"default":"primary",onClick:(0,a.D$)(n.toggleCameraProjectionMode,["stop"]),size:"default",disabled:l.viewerControls.usingExternalCamera,circle:""},{default:(0,o.k6)(()=>[(0,o.bF)(d,null,{default:(0,o.k6)(()=>[(0,o.bF)(k)]),_:1})]),_:1},8,["type","onClick","disabled"])]),_:1})]),(0,o.Lk)("div",y,[(0,o.bF)(m,{effect:"dark",content:"切换点云模式",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{type:l.viewerControls.isPointCloudMode?"primary":"default",onClick:(0,a.D$)(n.togglePointCloudMode,["stop"]),size:"default",disabled:l.viewerControls.usingExternalCamera,circle:""},{default:(0,o.k6)(()=>[(0,o.bF)(d,null,{default:(0,o.k6)(()=>[(0,o.bF)(V)]),_:1})]),_:1},8,["type","onClick","disabled"])]),_:1})]),(0,o.Lk)("div",S,[(0,o.bF)(m,{effect:"dark",content:"焦距+",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{onClick:(0,a.D$)(n.adjustFocalUp,["stop"]),size:"default",circle:""},{default:(0,o.k6)(()=>[...t[21]||(t[21]=[(0,o.Lk)("img",{src:"focusPlus.svg",alt:"",style:{width:"20px",height:"20px"}},null,-1)])]),_:1},8,["onClick"])]),_:1})]),(0,o.Lk)("div",P,[(0,o.bF)(m,{effect:"dark",content:"焦距-",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{onClick:(0,a.D$)(n.adjustFocalDown,["stop"]),size:"default",circle:""},{default:(0,o.k6)(()=>[...t[22]||(t[22]=[(0,o.Lk)("img",{src:"focusMinus.svg",alt:"",style:{width:"20px",height:"20px"}},null,-1)])]),_:1},8,["onClick"])]),_:1})]),(0,o.Lk)("div",x,[(0,o.bF)(m,{effect:"dark",content:"点+",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{onClick:(0,a.D$)(n.increaseSplatScale,["stop"]),size:"default",disabled:l.viewerControls.usingExternalCamera,circle:""},{default:(0,o.k6)(()=>[...t[23]||(t[23]=[(0,o.Lk)("img",{src:"Plus.svg",alt:"",style:{width:"20px",height:"20px"}},null,-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),(0,o.Lk)("div",D,[(0,o.bF)(m,{effect:"dark",content:"点-",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{onClick:(0,a.D$)(n.decreaseSplatScale,["stop"]),size:"default",disabled:l.viewerControls.usingExternalCamera,circle:""},{default:(0,o.k6)(()=>[...t[24]||(t[24]=[(0,o.Lk)("img",{src:"Minus.svg",alt:"",style:{width:"20px",height:"20px"}},null,-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),(0,o.Lk)("div",E,[(0,o.bF)(m,{effect:"dark",content:"相机上移",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{onClick:t[4]||(t[4]=(0,a.D$)(e=>n.handleCameraClick("up"),["stop"])),onTouchstart:t[5]||(t[5]=(0,a.D$)(e=>n.startLongPress("up"),["stop"])),onTouchend:t[6]||(t[6]=(0,a.D$)(e=>n.stopLongPress(),["stop"])),onTouchmove:t[7]||(t[7]=(0,a.D$)(e=>n.stopLongPress(),["stop"])),size:"default",disabled:l.viewerControls.usingExternalCamera,circle:""},{default:(0,o.k6)(()=>[...t[25]||(t[25]=[(0,o.Lk)("img",{src:"cameraUp.svg",alt:"",style:{width:"20px",height:"20px"}},null,-1)])]),_:1},8,["disabled"])]),_:1})]),(0,o.Lk)("div",_,[(0,o.bF)(m,{effect:"dark",content:"相机下移",placement:"top"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{onClick:t[8]||(t[8]=(0,a.D$)(e=>n.handleCameraClick("down"),["stop"])),onTouchstart:t[9]||(t[9]=(0,a.D$)(e=>n.startLongPress("down"),["stop"])),onTouchend:t[10]||(t[10]=(0,a.D$)(e=>n.stopLongPress(),["stop"])),onTouchmove:t[11]||(t[11]=(0,a.D$)(e=>n.stopLongPress(),["stop"])),size:"default",disabled:l.viewerControls.usingExternalCamera,circle:""},{default:(0,o.k6)(()=>[...t[26]||(t[26]=[(0,o.Lk)("img",{src:"cameraDown.svg",alt:"",style:{width:"20px",height:"20px"}},null,-1)])]),_:1},8,["disabled"])]),_:1})])],2)],36)])}s(6573),s(8100),s(7936),s(9577),s(1549),s(9797),s(9631),s(5623),s(4979);var U=s(9399),R=s(8507),M=s(1219),A=s(7477);let N=null;var I={components:{Search:A.Search,WindPower:A.WindPower,Place:A.Place,Camera:A.Camera,MostlyCloudy:A.MostlyCloudy,ElTooltip:R.R7},props:{isView:{type:Boolean,required:!0},viewData:{type:ArrayBuffer,default:null},viewFileName:{type:String,default:null}},data(){return{isManualFullscreen:!1,splatScene:!1,isViewerLoading:!0,touchStartTime:0,touchCount:0,touchTimeout:null,totalDragX:0,totalDragY:0,dragThreshold:5,isControlPanelOpen:!1,viewerControls:{showInfo:!1,showMeshCursor:!0,showControlPlane:!1,focalAdjustment:0,isOrthographicCamera:!0,isPointCloudMode:!1,usingExternalCamera:!1},isDragging:!1,floatLeft:800,floatTop:400,startX:0,startY:0,screenPadding:20,longPressTimer:null,currentPressDir:null,isGlowing:{up:!1,down:!1},glowTimer:null}},methods:{initViewer(){const e=this.$refs.viewerContainer;if(!e)return;const t={rootElement:e,cameraUp:[0,-1,-.6],initialCameraPosition:[0,1,5],initialCameraLookAt:[0,0,0],antialiased:!1,sphericalHarmonicsDegree:0,gpuAcceleratedSort:!1,sharedMemoryForWorkers:!1};try{N=new U.jM(t),this.isViewerLoading=!1,M.nk.success("渲染环境准备就绪")}catch(s){this.isViewerLoading=!1,M.nk.error("初始化渲染器失败："+s.message)}},resetCamera(){N&&(N.resetCamera(),M.nk.info("相机已重置"))},loadModelFromFlutter(){if(M.nk.info("请求读取模型..."),this.isViewerLoading=!0,window.FlutterFileChannel)window.FlutterFileChannel.postMessage("readFile");else{const e=document.createElement("input");e.type="file",e.accept=".ply,.splat,.ksplat",e.title="请选择.ply、.splat或.ksplat格式的模型文件",e.addEventListener("change",e=>{const t=e.target.files[0];if(!t)return this.isViewerLoading=!1,void M.nk.error("未选择任何文件");const s=["ply","splat","ksplat"],a=t.name.split(".").pop().toLowerCase();if(!s.includes(a))return this.isViewerLoading=!1,void M.nk.error("请选择.ply、.splat或.ksplat格式的模型文件");const i=new FileReader;i.onload=e=>{const s=e.target.result.split(",")[1];this.renderFromBase64(t.name,s)},i.onerror=()=>{this.isViewerLoading=!1,M.nk.error("文件读取失败，请重试")},i.readAsDataURL(t)}),e.click()}},renderFromBase64(e,t){try{const s=atob(t),a=new ArrayBuffer(s.length),i=new Uint8Array(a);for(let e=0;e<s.length;e++)i[e]=s.charCodeAt(e);this.renderFromArrayBuffer(e,a)}catch(s){this.isViewerLoading=!1,M.nk.error("解析模型失败："+s.message)}},renderFromArrayBuffer(e,t){try{this.splatScene&&N&&N.removeSplatScene(0);const s=U.r6.sceneFormatFromPath(e);this.fileBufferToSplatBuffer(t,s).then(t=>{N.addSplatBuffers([t],[{splatAlphaRemovalThreshold:1}]).then(()=>{this.splatScene=!0,this.isViewerLoading=!1,N.start(),M.nk.success(`模型${e}加载成功！`)})}).catch(e=>{this.isViewerLoading=!1,M.nk.error("解析模型失败："+e.message)})}catch(s){this.isViewerLoading=!1,M.nk.error("解析模型失败："+s.message)}},fileBufferToSplatBuffer(e,t){return new Promise((s,a)=>{try{let i;if(t===U.S0.KSplat)i=U.np.loadFromFileData(e);else if(t===U.S0.Ply)i=U.Jn.loadFromFileData(e,1,0,!0,0);else{if(t!==U.S0.Splat)return void a(new Error("不支持的文件格式："+t));i=U.aC.loadFromFileData(e,1,0,!0)}i.then(s).catch(a)}catch(i){a(new Error("格式转换失败："+i.message))}})},receiveFileData(e,t){window.FlutterFileChannel&&this.renderFromBase64(e,t)},receiveFileError(e){this.isViewerLoading=!1,M.nk.error(e)},triggerKeyAction(e){if(!this.splatScene||!N)return;const t=t=>{document.dispatchEvent(new KeyboardEvent(t,{code:e,bubbles:!0,cancelable:!0}))};t("keydown"),setTimeout(()=>t("keyup"),50)},toggleInfoPanel(){this.viewerControls.showInfo=!this.viewerControls.showInfo,this.triggerKeyAction("KeyI")},toggleMeshCursor(){this.viewerControls.showMeshCursor=!this.viewerControls.showMeshCursor,this.triggerKeyAction("KeyC")},toggleControlPlane(){this.viewerControls.showControlPlane=!this.viewerControls.showControlPlane,this.triggerKeyAction("KeyU")},togglePointCloudMode(){this.viewerControls.isPointCloudMode=!this.viewerControls.isPointCloudMode,this.triggerKeyAction("KeyP")},adjustFocalUp(){this.triggerKeyAction("KeyG")},adjustFocalDown(){this.triggerKeyAction("KeyF")},toggleCameraProjectionMode(){this.viewerControls.isOrthographicCamera=!this.viewerControls.isOrthographicCamera,this.triggerKeyAction("KeyO")},increaseSplatScale(){this.triggerKeyAction("Equal")},decreaseSplatScale(){this.triggerKeyAction("Minus")},upCamera(){this.triggerKeyAction("ArrowRight")},downCamera(){this.triggerKeyAction("ArrowLeft")},handleCameraClick(e){this.viewerControls.usingExternalCamera||("up"===e?this.upCamera():this.downCamera(),this.triggerGlow(e))},triggerGlow(e){this.glowTimer&&clearTimeout(this.glowTimer),this.isGlowing[e]=!0,this.glowTimer=setTimeout(()=>{this.isGlowing[e]=!1},1e3)},startLongPress(e){this.viewerControls.usingExternalCamera||(this.currentPressDir=e,this.longPressTimer=setTimeout(()=>{this.continueLongPress()},300))},continueLongPress(){this.currentPressDir&&("up"===this.currentPressDir?this.upCamera():this.downCamera(),this.longPressTimer=setTimeout(()=>{this.continueLongPress()},100))},stopLongPress(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.currentPressDir=null},toggleFullScreen(){const e=this.$refs.viewerContainer;if(e)if(document.fullscreenEnabled)try{document.fullscreenElement?document.exitFullscreen().then(()=>{N.init(),M.nk.info("已退出全屏模式（双击可进入）")}):e.requestFullscreen().then(()=>{N.init(),M.nk.info("已进入全屏模式（双击可退出）")})}catch(t){M.nk.error(`全屏操作失败：${t.message}`),console.error("全屏切换错误：",t)}else M.nk.error("当前浏览器不支持全屏功能")},handleTouchStart(e){if(1!==e.touches.length)return this.touchCount=0,void clearTimeout(this.touchTimeout);e.preventDefault();const t=Date.now(),s=300;0===this.touchCount?(this.touchStartTime=t,this.touchCount=1,this.touchTimeout=setTimeout(()=>{this.touchCount=0},s)):1===this.touchCount&&t-this.touchStartTime<=s&&(clearTimeout(this.touchTimeout),this.isManualFullscreen=!this.isManualFullscreen,this.touchCount=0)},async destroyPreViewer(){if(N&&this.splatScene)try{N.removeSplatScene(0),this.splatScene=!1,await N.dispose(),N=null}catch(e){console.error("销毁 viewer 失败：",e)}},toggleControlPanel(){this.splatScene?this.isControlPanelOpen=!this.isControlPanelOpen:M.nk.warning("请先导入模型！")},closeControlPanel(){this.isControlPanelOpen&&(this.isControlPanelOpen=!1)},startDrag(e){this.isDragging=!0,"mousedown"===e.type?(this.startX=e.clientX,this.startY=e.clientY):(this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY),this.totalDragX=0,this.totalDragY=0;const t=document.querySelector(".control-float-btn");t.classList.add("pressed")},handleDrag(e){if(!this.isDragging)return;let t,s;e.preventDefault(),"mousemove"===e.type?(t=e.clientX,s=e.clientY):(t=e.touches[0].clientX,s=e.touches[0].clientY);const a=t-this.startX,i=s-this.startY,o=this.floatLeft+a,l=this.floatTop+i,r=window.innerWidth,n=window.innerHeight,c=54;this.floatLeft=Math.max(this.screenPadding,Math.min(o,r-c-this.screenPadding)),this.floatTop=Math.max(this.screenPadding,Math.min(l,n-c-this.screenPadding)),this.startX=t,this.startY=s},stopDrag(){const e=document.querySelector(".control-float-btn");e.classList.remove("pressed"),this.isDragging=!1}},mounted(){this.initViewer(),window.receiveFileError=this.receiveFileError,window.receiveFileData=this.receiveFileData;const e=window.innerWidth,t=window.innerHeight,s=54;this.floatLeft=e-s-this.screenPadding,this.floatTop=t/2-s/2,window.scrollTo({top:0,behavior:"smooth"}),this.isView&&N&&this.renderFromArrayBuffer(this.viewFileName,this.viewData)},beforeUnmount(){window.receiveFileData=null,window.receiveFileError=null,this.destroyPreViewer(),this.longPressTimer&&clearTimeout(this.longPressTimer),this.glowTimer&&clearTimeout(this.glowTimer);const e=this.$refs.viewerContainer;if(e)while(e.firstChild)e.removeChild(e.firstChild)}},$=s(1241);const B=(0,$.A)(I,[["render",V],["__scopeId","data-v-380f475a"]]);var W=B;const O={class:"profile-page"},X={class:"user-card"},j={class:"user-info"},G={class:"username"},K={class:"user-email"},q={class:"stats-grid"},z={class:"stat-item"},Y={class:"stat-value"},Q={class:"stat-item"},H={class:"stat-value"},J={class:"stat-item"},Z={class:"stat-value"},ee={class:"task-name"},te={class:"task-time"},se={class:"action-buttons"};function ae(e,t,s,a,i,l){const n=(0,o.g2)("el-button"),c=(0,o.g2)("el-empty"),d=(0,o.g2)("el-table-column"),u=(0,o.g2)("el-tag"),h=(0,o.g2)("el-table"),m=(0,o.g2)("el-card"),p=(0,o.g2)("el-input"),g=(0,o.g2)("el-form-item"),k=(0,o.g2)("el-form"),f=(0,o.g2)("el-dialog"),v=(0,o.g2)("el-switch");return(0,o.uX)(),(0,o.CE)("div",O,[(0,o.Lk)("div",X,[t[10]||(t[10]=(0,o.Lk)("div",{class:"avatar-container"},null,-1)),(0,o.Lk)("div",j,[(0,o.Lk)("h2",G,(0,r.v_)(i.userName),1),(0,o.Lk)("p",K,(0,r.v_)(i.userEmail),1),(0,o.bF)(n,{type:"text",class:"edit-btn",onClick:t[0]||(t[0]=e=>i.showEditDialog=!0)},{default:(0,o.k6)(()=>[...t[9]||(t[9]=[(0,o.eW)(" 编辑资料 ",-1)])]),_:1})])]),(0,o.Lk)("div",q,[(0,o.Lk)("div",z,[(0,o.Lk)("p",Y,(0,r.v_)(i.totalTasks),1),t[11]||(t[11]=(0,o.Lk)("p",{class:"stat-label"},"总任务数",-1))]),(0,o.Lk)("div",Q,[(0,o.Lk)("p",H,(0,r.v_)(i.completedTasks),1),t[12]||(t[12]=(0,o.Lk)("p",{class:"stat-label"},"已完成",-1))]),(0,o.Lk)("div",J,[(0,o.Lk)("p",Z,(0,r.v_)(i.processingTasks),1),t[13]||(t[13]=(0,o.Lk)("p",{class:"stat-label"},"处理中",-1))])]),t[20]||(t[20]=(0,o.Lk)("div",{class:"section-title"},"最近任务",-1)),(0,o.bF)(m,{class:"task-list-card"},{default:(0,o.k6)(()=>[0===i.recentTasks.length?((0,o.uX)(),(0,o.Wv)(c,{key:0,description:"暂无任务记录"})):((0,o.uX)(),(0,o.Wv)(h,{key:1,data:i.recentTasks,class:"task-table",border:"",stripe:"","header-cell-style":{background:"#f5f7fa",fontSize:"14px",padding:"10px 0"},"cell-style":{padding:"12px 8px"}},{default:(0,o.k6)(()=>[(0,o.bF)(d,{prop:"name",label:"任务名称",align:"left",width:"220"},{default:(0,o.k6)(e=>[(0,o.Lk)("span",ee,(0,r.v_)(e.row.name),1)]),_:1}),(0,o.bF)(d,{prop:"createTime",label:"创建时间",align:"center",width:"180"},{default:(0,o.k6)(e=>[(0,o.Lk)("span",te,(0,r.v_)(l.formatTime(e.row.createTime)),1)]),_:1}),(0,o.bF)(d,{prop:"status",label:"状态",align:"center",width:"120"},{default:(0,o.k6)(e=>[(0,o.bF)(u,{type:"SUCCESS"===e.row.status?"success":"RUNNING"===e.row.status?"info":"danger",class:"task-status"},{default:(0,o.k6)(()=>[(0,o.eW)((0,r.v_)("SUCCESS"===e.row.status?"已完成":"RUNNING"===e.row.status?"处理中":"已失败"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]))]),_:1}),(0,o.Lk)("div",se,[(0,o.bF)(n,{type:"primary",class:"primary-btn",onClick:l.goToCreateTask},{default:(0,o.k6)(()=>[...t[14]||(t[14]=[(0,o.eW)(" 切换用户 ",-1)])]),_:1},8,["onClick"]),(0,o.bF)(n,{type:"warning",class:"logout-btn",onClick:l.handleLogout},{default:(0,o.k6)(()=>[...t[15]||(t[15]=[(0,o.eW)(" 退出登录 ",-1)])]),_:1},8,["onClick"])]),(0,o.bF)(f,{title:"编辑资料",modelValue:i.showEditDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>i.showEditDialog=e),width:"80%"},{footer:(0,o.k6)(()=>[(0,o.bF)(n,{onClick:t[3]||(t[3]=e=>i.showEditDialog=!1)},{default:(0,o.k6)(()=>[...t[16]||(t[16]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"primary",onClick:l.saveUserInfo},{default:(0,o.k6)(()=>[...t[17]||(t[17]=[(0,o.eW)("保存",-1)])]),_:1},8,["onClick"])]),default:(0,o.k6)(()=>[(0,o.bF)(k,{ref:"editForm",model:i.editForm,rules:i.editRules,"label-width":"80px"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{label:"用户名",prop:"username"},{default:(0,o.k6)(()=>[(0,o.bF)(p,{modelValue:i.editForm.username,"onUpdate:modelValue":t[1]||(t[1]=e=>i.editForm.username=e)},null,8,["modelValue"])]),_:1}),(0,o.bF)(g,{label:"邮箱",prop:"email"},{default:(0,o.k6)(()=>[(0,o.bF)(p,{modelValue:i.editForm.email,"onUpdate:modelValue":t[2]||(t[2]=e=>i.editForm.email=e),type:"email"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),(0,o.bF)(f,{title:"设置",modelValue:i.showSettingDialog,"onUpdate:modelValue":t[8]||(t[8]=e=>i.showSettingDialog=e),width:"80%"},{footer:(0,o.k6)(()=>[(0,o.bF)(n,{onClick:t[7]||(t[7]=e=>i.showSettingDialog=!1)},{default:(0,o.k6)(()=>[...t[19]||(t[19]=[(0,o.eW)("确定",-1)])]),_:1})]),default:(0,o.k6)(()=>[(0,o.bF)(v,{modelValue:i.notificationEnabled,"onUpdate:modelValue":t[5]||(t[5]=e=>i.notificationEnabled=e),"active-text":"通知已开启","inactive-text":"通知已关闭",class:"setting-item"},null,8,["modelValue"]),(0,o.bF)(v,{modelValue:i.autoSaveEnabled,"onUpdate:modelValue":t[6]||(t[6]=e=>i.autoSaveEnabled=e),"active-text":"自动保存已开启","inactive-text":"自动保存已关闭",class:"setting-item"},null,8,["modelValue"]),(0,o.bF)(n,{type:"text",class:"version-info"},{default:(0,o.k6)(()=>[...t[18]||(t[18]=[(0,o.eW)(" 当前版本: v1.0.0 ",-1)])]),_:1})]),_:1},8,["modelValue"])])}s(4114);var ie=s(4373);const oe=[{id:1001,name:"客厅场景3D重建",createTime:"2023-10-21T14:30:25",status:"SUCCESS",duration:"15分钟",fileSize:"18.5MB"},{id:1002,name:"户外建筑扫描处理",createTime:"2023-10-21T11:15:40",status:"RUNNING",duration:"8分钟（进行中）",progress:68},{id:1003,name:"产品模型生成",createTime:"2023-10-20T09:50:12",status:"FAILED",duration:"5分钟",error:"视频清晰度不足，无法提取特征点"},{id:1004,name:"卧室全景建模",createTime:"2023-10-20T16:22:30",status:"SUCCESS",duration:"12分钟",fileSize:"12.3MB"}];var le={data(){return{userName:"小明",userEmail:"xxxxxxx@xxx.com",totalTasks:0,completedTasks:0,processingTasks:0,recentTasks:oe,showEditDialog:!1,showSettingDialog:!1,editForm:{username:"",email:"",avatar:""},editRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:16,message:"用户名长度为3-16位",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},notificationEnabled:!0,autoSaveEnabled:!0}},methods:{formatTime(e){const t=new Date(e);return t.toLocaleString()},goToTaskDetail(e){this.$router.push(`/task-detail?id=${e}`)},goToCreateTask(){this.$router.push("/task")},handleLogout(){this.$confirm("确定要退出登录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{localStorage.removeItem("token"),localStorage.removeItem("username"),this.$router.push("/login"),this.$message.success("退出登录成功")}).catch(()=>{})},handleAvatarChange(e){const t=new FileReader;t.onload=e=>{this.editForm.avatar=e.target.result},t.readAsDataURL(e.raw)},async saveUserInfo(){const e=await this.$refs.editForm.validate();if(e)try{await ie.A.post("/api/user/update",this.editForm),this.userName=this.editForm.username,this.userEmail=this.editForm.email,this.userAvatar=this.editForm.avatar,this.showEditDialog=!1,this.$message.success("资料更新成功")}catch(t){this.$message.error("资料更新失败，请重试")}},async getUserInfo(){try{const e=await ie.A.get("/api/user/info"),t=e.data.data;this.userName=t.username,this.userEmail=t.email,this.editForm.username=t.username,this.editForm.email=t.email}catch(e){console.error("获取用户信息失败",e)}},async getTaskStats(){try{const e=await ie.A.get("/api/user/task-stats"),t=e.data.data;this.totalTasks=t.total,this.completedTasks=t.completed,this.processingTasks=t.processing}catch(e){console.error("获取任务统计失败",e)}},async getRecentTasks(){try{const e=await ie.A.get("/api/user/recent-tasks");this.recentTasks=e.data.data||[]}catch(e){console.error("获取最近任务失败",e)}}},mounted(){window.scrollTo({top:0,behavior:"smooth"})}};const re=(0,$.A)(le,[["render",ae],["__scopeId","data-v-8f2485cc"]]);var ne=re;const ce={class:"task-progress-page"},de={class:"filter-bar"},ue={key:0,class:"empty-state"},he={class:"task-details"},me={class:"detail-item"},pe={class:"detail-value"},ge={class:"detail-item progress-item"},ke={class:"progress-container"},fe={class:"progress-text"},ve={class:"detail-item"},be={class:"detail-item"},we={class:"detail-value"},Ce={key:0,class:"detail-item"},Fe={class:"detail-value"},Te={key:1,class:"detail-item error-message"},Le={class:"error-text"},ye={class:"action-buttons"};function Se(e,t,s,a,i,l){const n=(0,o.g2)("el-option"),c=(0,o.g2)("el-select"),d=(0,o.g2)("Refresh"),u=(0,o.g2)("el-icon"),h=(0,o.g2)("el-button"),m=(0,o.g2)("el-empty"),p=(0,o.g2)("el-progress"),g=(0,o.g2)("el-tag"),k=(0,o.g2)("View"),f=(0,o.g2)("Download"),v=(0,o.g2)("Delete"),b=(0,o.g2)("el-collapse-item"),w=(0,o.g2)("el-collapse");return(0,o.uX)(),(0,o.CE)("div",ce,[(0,o.Lk)("div",de,[(0,o.bF)(c,{modelValue:i.statusFilter,"onUpdate:modelValue":t[0]||(t[0]=e=>i.statusFilter=e),placeholder:"筛选状态",class:"status-select",onChange:l.handleStatusFilter},{default:(0,o.k6)(()=>[(0,o.bF)(n,{label:"全部任务",value:"all"}),(0,o.bF)(n,{label:"等待中",value:"WAITING"}),(0,o.bF)(n,{label:"处理中",value:"RUNNING"}),(0,o.bF)(n,{label:"已完成",value:"SUCCESS"}),(0,o.bF)(n,{label:"已失败",value:"FAILED"})]),_:1},8,["modelValue","onChange"]),(0,o.bF)(h,{class:"nav-btn refresh-btn",loading:i.isRefreshing,onClick:l.refreshTasks},{default:(0,o.k6)(()=>[(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d)]),_:1})]),_:1},8,["loading","onClick"])]),(0,o.bF)(w,{modelValue:i.activeTaskNames,"onUpdate:modelValue":t[1]||(t[1]=e=>i.activeTaskNames=e),class:"task-collapse",accordion:""},{default:(0,o.k6)(()=>[0===i.filteredTasks.length?((0,o.uX)(),(0,o.CE)("div",ue,[(0,o.bF)(m,{description:"暂无任务数据","image-size":100})])):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.filteredTasks,e=>((0,o.uX)(),(0,o.Wv)(b,{key:e.id,title:`任务 ${e.name}（${l.getStatusText(e.status)}）`,name:`task-${e.id}`,class:"task-item"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",he,[(0,o.Lk)("div",me,[t[2]||(t[2]=(0,o.Lk)("span",{class:"detail-label"},[(0,o.Lk)("i",{class:"el-icon-key detail-icon"}),(0,o.eW)("任务ID ")],-1)),(0,o.Lk)("span",pe,(0,r.v_)(e.id),1)]),(0,o.Lk)("div",ge,[t[3]||(t[3]=(0,o.Lk)("span",{class:"detail-label"},[(0,o.Lk)("i",{class:"el-icon-loading detail-icon"}),(0,o.eW)("进度 ")],-1)),(0,o.Lk)("div",ke,[(0,o.bF)(p,{percentage:e.progress,status:l.getProgressStatus(e.status),class:"task-progress"},null,8,["percentage","status"]),(0,o.Lk)("span",fe,(0,r.v_)(e.progress)+"%",1)])]),(0,o.Lk)("div",ve,[t[4]||(t[4]=(0,o.Lk)("span",{class:"detail-label"},[(0,o.Lk)("i",{class:"el-icon-info detail-icon"}),(0,o.eW)("状态 ")],-1)),(0,o.bF)(g,{type:l.getStatusTagType(e.status),class:"status-tag"},{default:(0,o.k6)(()=>[(0,o.eW)((0,r.v_)(l.getStatusText(e.status)),1)]),_:2},1032,["type"])]),(0,o.Lk)("div",be,[t[5]||(t[5]=(0,o.Lk)("span",{class:"detail-label"},[(0,o.Lk)("i",{class:"el-icon-clock detail-icon"}),(0,o.eW)("开始时间 ")],-1)),(0,o.Lk)("span",we,(0,r.v_)(l.formatTime(e.createTime)),1)]),"SUCCESS"===e.status||"FAILED"===e.status?((0,o.uX)(),(0,o.CE)("div",Ce,[t[6]||(t[6]=(0,o.Lk)("span",{class:"detail-label"},[(0,o.Lk)("i",{class:"el-icon-check detail-icon"}),(0,o.eW)("结束时间 ")],-1)),(0,o.Lk)("span",Fe,(0,r.v_)(l.formatTime(e.updateTime)),1)])):(0,o.Q3)("",!0),"FAILED"===e.status&&e.errorMsg?((0,o.uX)(),(0,o.CE)("div",Te,[t[7]||(t[7]=(0,o.Lk)("span",{class:"detail-label"},[(0,o.Lk)("i",{class:"el-icon-warning detail-icon"}),(0,o.eW)("错误原因 ")],-1)),(0,o.Lk)("span",Le,(0,r.v_)(e.errorMsg),1)])):(0,o.Q3)("",!0),(0,o.Lk)("div",ye,[(0,o.bF)(h,{type:"success",class:"action-btn view-btn",disabled:!("SUCCESS"===e.status&&e.resultUrl),onClick:t=>l.handleViewResult(e.id)},{default:(0,o.k6)(()=>[t[8]||(t[8]=(0,o.eW)(" 查看模型",-1)),(0,o.bF)(u,{class:"el-icon--right"},{default:(0,o.k6)(()=>[(0,o.bF)(k)]),_:1})]),_:1},8,["disabled","onClick"]),(0,o.bF)(h,{type:"primary",class:"action-btn download-btn",disabled:!("SUCCESS"===e.status&&e.resultUrl),onClick:t=>l.handleDownloadResult(e.id)},{default:(0,o.k6)(()=>[t[9]||(t[9]=(0,o.eW)(" 下载模型",-1)),(0,o.bF)(u,{class:"el-icon--right"},{default:(0,o.k6)(()=>[(0,o.bF)(f)]),_:1})]),_:1},8,["disabled","onClick"]),(0,o.bF)(h,{type:"danger",class:"action-btn delete-btn",disabled:"RUNNING"===e.status,onClick:t=>l.handleDeleteTask(e.id)},{default:(0,o.k6)(()=>[t[10]||(t[10]=(0,o.eW)(" 删除任务",-1)),(0,o.bF)(u,{class:"el-icon--right"},{default:(0,o.k6)(()=>[(0,o.bF)(v)]),_:1})]),_:1},8,["disabled","onClick"])])])]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])])}s(8111),s(2489),s(4603),s(7566),s(8721);const Pe="https://",xe=[{id:"20251021-001",name:"建筑场景3D重建",progress:100,status:"SUCCESS",createTime:"2025-10-21T09:30:00",updateTime:"2025-10-21T10:15:30",resultUrl:"/api/models/building-3d.ply"},{id:"20251021-002",name:"室内家具扫描处理",progress:65,status:"RUNNING",createTime:"2025-10-21T10:30:00",updateTime:"2025-10-21T10:45:00",resultUrl:null},{id:"20251021-003",name:"地形点云生成",progress:0,status:"WAITING",createTime:"2025-10-21T11:00:00",updateTime:"2025-10-21T11:00:00",resultUrl:null},{id:"20251021-004",name:"文物模型修复",progress:30,status:"FAILED",createTime:"2025-10-21T08:15:00",updateTime:"2025-10-21T08:40:00",resultUrl:null,errorMsg:"视频数据损坏，无法解析"}];var De={emits:["viewResult"],data(){return{tasks:xe,filteredTasks:xe,activeTaskNames:[],statusFilter:"all",isRefreshing:!1,refreshTimer:null}},methods:{doTask(){console.log("doTask")},async refreshTasks(){this.isRefreshing=!0;try{const e=await ie.A.get(`${Pe}/api/getTasks`,{params:{userId:localStorage.getItem("userId")}});this.tasks=e.data.data||[],this.filteredTasks=[...this.tasks],this.tasks.length>0&&0===this.activeTaskNames.length&&(this.activeTaskNames=[`task-${this.tasks[0].id}`])}catch(e){this.$message.error("获取任务列表失败，请重试"),console.error("Task fetch error:",e)}finally{this.isRefreshing=!1}},handleStatusFilter(){"all"===this.statusFilter?this.filteredTasks=[...this.tasks]:this.filteredTasks=this.tasks.filter(e=>e.status===this.statusFilter),this.filteredTasks.length>0?this.activeTaskNames=[`task-${this.filteredTasks[0].id}`]:this.activeTaskNames=[]},formatTime(e){if(!e)return"——";const t=new Date(e);return t.toLocaleString()},getStatusText(e){const t={WAITING:"等待中",RUNNING:"处理中",SUCCESS:"已完成",FAILED:"已失败"};return t[e]||"未知状态"},getStatusTagType(e){const t={WAITING:"info",RUNNING:"primary",SUCCESS:"success",FAILED:"danger"};return t[e]||"default"},getProgressStatus(e){return"SUCCESS"===e?"success":"FAILED"===e?"exception":""},handleViewResult(e){ie.A.get(`${Pe}/api/viewTask`,{params:{taskID:e}}).then(e=>{const t=e.data.data,s=e.data.fileName;this.$emit("viewResult",t,s)}).catch(()=>{M.nk.error("下载失败，请重试")})},handleDownloadResult(e){ie.A.get(`${Pe}/api/delteTask`,{params:{taskID:e}}).then(e=>{const t=e.data.data,s=e.data.fileName;if(window.FlutterFileSaveChannel){const e=new Uint8Array(t);let a="";for(let t=0;t<e.length;t++)a+=String.fromCharCode(e[t]);const i=btoa(a),o={action:"save",fileName:s,base64String:i};window.FlutterVideosChannel.postMessage(JSON.stringify(o))}else{const e=new Blob([t]),s=document.createElement("a");s.href=URL.createObjectURL(e),s.download=`model-${Date.now()}.ply`,s.click(),URL.revokeObjectURL(s.href)}}).catch(()=>{M.nk.error("下载失败，请重试")})},handleDeleteTask(e){ie.A.get(`${Pe}/api/delteTask`,{params:{taskID:e}}).then(()=>{})}},mounted(){window.scrollTo({top:0,behavior:"smooth"})},beforeUnmount(){clearInterval(this.refreshTimer)}};const Ee=(0,$.A)(De,[["render",Se],["__scopeId","data-v-13e6e0a8"]]);var _e=Ee;const Ve={class:"upload-task-container"},Ue={class:"upload-card"},Re={class:"video-select-group"},Me={class:"video-btn-group"},Ae={key:0,class:"el-icon-picture-outline"},Ne={key:0,class:"selected-video-tags"},Ie={key:0,class:"el-icon-check"},$e={key:0,class:"video-previews"},Be={class:"preview-header"},We={class:"preview-count"},Oe={class:"preview-container"},Xe={class:"video-wrapper"},je=["src","onError","onDblclick"],Ge={class:"video-name"};function Ke(e,t,s,a,i,l){const n=(0,o.g2)("el-input"),c=(0,o.g2)("el-form-item"),d=(0,o.g2)("el-input-number"),u=(0,o.g2)("el-button"),h=(0,o.g2)("el-tag"),m=(0,o.g2)("el-progress"),p=(0,o.g2)("el-form");return(0,o.uX)(),(0,o.CE)("div",Ve,[(0,o.Lk)("div",Ue,[t[7]||(t[7]=(0,o.Lk)("div",{class:"card-header"},[(0,o.Lk)("h4",{class:"card-title"},"参数设置")],-1)),(0,o.bF)(p,{ref:"paramForm",model:i.form,"label-width":"90px",class:"param-form",rules:i.formRules,size:"default"},{default:(0,o.k6)(()=>[(0,o.bF)(c,{label:"任务名称",prop:"taskName"},{default:(0,o.k6)(()=>[(0,o.bF)(n,{modelValue:i.form.taskName,"onUpdate:modelValue":t[0]||(t[0]=e=>i.form.taskName=e),placeholder:"请输入任务名称（如：建筑模型处理）",class:"custom-input"},null,8,["modelValue"])]),_:1}),(0,o.bF)(c,{label:"FPS",prop:"fps"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{modelValue:i.form.fps,"onUpdate:modelValue":t[1]||(t[1]=e=>i.form.fps=e),min:1,max:60,placeholder:"设置渲染帧率（1-60）",class:"custom-input"},null,8,["modelValue"])]),_:1}),(0,o.bF)(c,{label:"视频文件",class:"video-form-item"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Re,[(0,o.Lk)("div",Me,[(0,o.bF)(u,{type:"primary",onClick:t[2]||(t[2]=e=>l.loadVideoFromFlutter(0)),loading:i.isVideoLoading,class:"video-btn"},{default:(0,o.k6)(()=>[i.isVideoLoading?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("i",Ae)),t[4]||(t[4]=(0,o.Lk)("span",null,"从相册选择",-1))]),_:1},8,["loading"]),(0,o.bF)(u,{type:"primary",onClick:t[3]||(t[3]=e=>l.loadVideoFromFlutter(1)),class:"video-btn"},{default:(0,o.k6)(()=>[...t[5]||(t[5]=[(0,o.Lk)("i",{class:"el-icon-camera"},null,-1),(0,o.Lk)("span",null,"相机拍摄",-1)])]),_:1})]),i.form.videoFiles.length>0?((0,o.uX)(),(0,o.CE)("div",Ne,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.form.videoFiles,(e,t)=>((0,o.uX)(),(0,o.Wv)(h,{key:e.name,closable:"",onClose:e=>l.clearVideoFile(t),class:"video-tag"},{default:(0,o.k6)(()=>[(0,o.eW)((0,r.v_)(e.name),1)]),_:2},1032,["onClose"]))),128))])):(0,o.Q3)("",!0)])]),_:1}),(0,o.bF)(c,{class:"submit-group"},{default:(0,o.k6)(()=>[i.showUploadProgress?((0,o.uX)(),(0,o.Wv)(m,{key:0,percentage:i.uploadProgressPercentage,status:i.uploadStatus,class:"upload-progress"},null,8,["percentage","status"])):(0,o.Q3)("",!0),(0,o.bF)(u,{type:"success",onClick:l.submitForm,disabled:!i.isVideoLoaded||!i.form.fps||i.showUploadProgress||!i.form.taskName,class:"submit-btn"},{default:(0,o.k6)(()=>[i.showUploadProgress?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("i",Ie)),t[6]||(t[6]=(0,o.Lk)("span",null,"创建任务",-1))]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["model","rules"])]),i.form.videoBlobs.length>0?((0,o.uX)(),(0,o.CE)("div",$e,[(0,o.Lk)("div",Be,[t[8]||(t[8]=(0,o.Lk)("h4",{class:"card-title"},"视频预览",-1)),(0,o.Lk)("span",We,(0,r.v_)(i.form.videoBlobs.length)+" 个视频",1)]),(0,o.Lk)("div",Oe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.form.videoBlobs,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"video-preview-item",key:t},[(0,o.Lk)("div",Xe,[(0,o.Lk)("video",{src:e.previewUrl,controls:"",class:"video-preview",onError:e=>l.handleVideoError(t),onDblclick:e=>l.toggleVideoFullscreen(t),poster:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23f1f1f1'/%3E%3Ccircle cx='50' cy='50' r='20' fill='%23ddd'/%3E%3Cpolygon points='40,35 60,50 40,65' fill='white'/%3E%3C/svg%3E"},null,40,je)]),(0,o.Lk)("div",Ge,(0,r.v_)(i.form.videoFiles[t].name),1)]))),128))])])):(0,o.Q3)("",!0)])}s(7588);var qe={emits:["TaskProcessingGetTasks"],data(){return{isSuccess:!1,statusText:"",errorText:"",isVideoLoading:!1,isVideoLoaded:!1,showUploadProgress:!1,uploadProgressPercentage:0,uploadStatus:"success",canLoadModel:!1,form:{taskName:"",fps:30,colmapFile:null,colmapFileName:"",videoBlobs:[],videoFiles:[]},formRules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],fps:[{required:!0,message:"请输入 FPS 参数（1-120）",trigger:"blur"},{type:"number",message:"FPS 必须为数字",trigger:"blur"}]}}},methods:{loadVideoFromFlutter(e){if(this.isVideoLoading=!0,this.isVideoLoaded=!1,window.FlutterVideosChannel)0===e?window.FlutterVideosChannel.postMessage("selectVideosByGallery"):1===e&&(this.isVideoLoading=!1,window.FlutterVideosChannel.postMessage("selectVideosByCamera"));else{const e=document.createElement("input");e.type="file",e.accept="video/*",e.multiple=!0,e.addEventListener("change",e=>{this.form.videoFiles=Array.from(e.target.files),this.form.videoFiles.length>0&&(this.form.videoBlobs=[],this.form.videoFiles.forEach(e=>{const t=new Blob([e]),s=URL.createObjectURL(t);this.form.videoBlobs.push({blob:t,previewUrl:s})}),this.isVideoLoading=!1,this.isVideoLoaded=!0)}),e.addEventListener("cancel",()=>{this.isVideoLoading=!1}),e.click()}},clearVideoFile(e){URL.revokeObjectURL(this.form.videoBlobs[e].previewUrl),this.form.videoBlobs.splice(e,1),this.form.videoFiles.splice(e,1),this.isVideoLoaded=this.form.videoFiles.length>0,this.isVideoLoaded||(this.statusText="")},handleVideoError(e){console.error(`视频加载错误: ${this.form.videoFiles[e].name}`)},toggleVideoFullscreen(e){const t=document.querySelector(`.video-preview-item:nth-child(${e+1}) video`);t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,s="x"==e?t:3&t|8;return s.toString(16)})},async submitForm(){const e=this.uuidv4(),t=await this.$refs.paramForm.validate();if(!t)return;this.showUploadProgress=!0;const s=new FormData;s.append("params",JSON.stringify({id:e,taskName:this.form.taskName,fps:this.form.fps})),this.form.videoFiles.forEach(e=>{s.append("videos",e)});try{const e=await ie.A.post("http://192.168.246.233:3002/api/upload",s,{timeout:3e5,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{e.total&&(this.uploadProgressPercentage=Math.round(e.loaded/e.total*100))}});if(console.log(e.data),this.showUploadProgress=!1,this.canLoadModel=!0,window.FlutterVideosChannel&&this.form.videoFiles.length>0){const e=this.form.videoFiles[0],t=new FileReader;t.onload=t=>{const s={action:"save",name:e.name,size:e.size,type:e.type,base64:t.target.result};window.FlutterVideosChannel.postMessage(JSON.stringify(s))},t.readAsDataURL(e)}this.form.videoFiles.forEach((e,t)=>{URL.revokeObjectURL(this.form.videoBlobs[t].previewUrl)}),this.form={...this.form,videoFiles:[],videoBlobs:[],taskName:""},this.isVideoLoaded=!1}catch(a){this.showUploadProgress=!1}},receiveMultipleVideos(e){if(0===e?.length)return this.isVideoLoaded=!1,void(this.isVideoLoading=!1);try{const t=JSON.parse(e);this.form.videoBlobs.forEach(e=>{URL.revokeObjectURL(e.previewUrl)}),this.form.videoBlobs=[],this.form.videoFiles=[],t.forEach(e=>{const t=e.fileName,s=e.base64Data,a=atob(s),i=new Uint8Array(a.length);for(let n=0;n<a.length;n++)i[n]=a.charCodeAt(n);const o=new Blob([i],{type:"video/"+t.split(".").pop()}),l=new File([o],t),r=URL.createObjectURL(o);this.form.videoBlobs.push({blob:o,previewUrl:r}),this.form.videoFiles.push(l)}),this.isVideoLoaded=!0,this.isVideoLoading=!1}catch(t){this.isVideoLoading=!1,console.error("解析视频数据失败：",t)}},receiveFileError(e){console.log(e)},handleScroll(){const e=document.querySelector(".submit-group"),t=document.querySelector(".upload-card");if(!e||!t)return;const s=t.getBoundingClientRect().bottom,a=window.innerHeight;s>a?(e.classList.add("submit-fixed"),t.style.paddingBottom="80px"):(e.classList.remove("submit-fixed"),t.style.paddingBottom="24px")}},mounted(){window.receiveFileError=this.receiveFileError,window.receiveMultipleVideos=this.receiveMultipleVideos,window.scrollTo({top:0,behavior:"smooth"}),window.innerWidth<=768&&window.addEventListener("scroll",this.handleScroll)},beforeUnmount(){window.receiveFileError=null,window.receiveMultipleVideos=null,this.form.videoBlobs.forEach(e=>{URL.revokeObjectURL(e.previewUrl)}),window.removeEventListener("scroll",this.handleScroll)}};const ze=(0,$.A)(qe,[["render",Ke],["__scopeId","data-v-ae3e0028"]]);var Ye=ze,Qe={components:{RenderTask:W,PersonStatus:ne,TaskProcessing:_e,UploadTask:Ye,Upload:A.Upload,Picture:A.Picture,Management:A.Management,User:A.User},data(){return{activeTab:"UploadTask",isView:!1,viewData:null,viewFileName:null,isManualTabChange:!1}},methods:{viewResult(e,t){this.isManualTabChange=!1,this.isView=!0,this.viewData=e,this.viewFileName=t,this.activeTab="RenderTask"},test(){console.log("123"),this.$refs.RenderTaskRef&&this.$refs.RenderTaskRef.doTask()},scrollToTop(){document.querySelector(".content-container").scrollTo({top:0,behavior:"smooth"})},handleTabClick(e){this.isManualTabChange=!0,this.activeTab=e,this.scrollToTop()}},watch:{activeTab(){this.isManualTabChange&&(this.isView=!1,this.isManualTabChange=!1)}}};const He=(0,$.A)(Qe,[["render",k],["__scopeId","data-v-0764dbe0"]]);var Je=He,Ze={name:"App",components:{HelloWorld:Je}};const et=(0,$.A)(Ze,[["render",l]]);var tt=et,st=s(8512);const at=[{path:"/render-task",component:W},{path:"/task-processing",component:_e},{path:"/person-status",component:ne}],it=(0,st.aE)({history:(0,st.Bt)(),routes:at});var ot=it;const lt=(0,a.Ef)(tt);lt.use(i.A),lt.use(ot),lt.mount("#app");for(const[rt,nt]of Object.entries(A))lt.component(rt,nt)}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,a,i,o){if(!a){var l=1/0;for(d=0;d<e.length;d++){a=e[d][0],i=e[d][1],o=e[d][2];for(var r=!0,n=0;n<a.length;n++)(!1&o||l>=o)&&Object.keys(s.O).every(function(e){return s.O[e](a[n])})?a.splice(n--,1):(r=!1,o<l&&(l=o));if(r){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[a,i,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var i,o,l=a[0],r=a[1],n=a[2],c=0;if(l.some(function(t){return 0!==e[t]})){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(n)var d=n(s)}for(t&&t(a);c<l.length;c++)o=l[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},a=self["webpackChunk_3dgs"]=self["webpackChunk_3dgs"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(5913)});a=s.O(a)})();
//# sourceMappingURL=app.0cf422f1.js.map